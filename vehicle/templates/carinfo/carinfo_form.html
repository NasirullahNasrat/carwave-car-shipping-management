{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% if form.instance.pk %}ویرایش{% else %}ایجاد{% endif %} معلومات جنس{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Main Form Card -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
        <div class="px-6 py-5 border-b border-gray-200 bg-gradient-to-r from-primary-50 to-primary-100">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-car mr-2 text-primary-600"></i>
                    {% if form.instance.pk %}ویرایش{% else %}ایجاد{% endif %} معلومات جنس
                </h3>
                {% if form.instance.pk and form.instance.purchase_info %}
                <a href="{% url 'purchaseinfo-update' form.instance.purchase_info.id %}" 
                   class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 transition-colors duration-200">
                    <i class="fas fa-shopping-cart ml-1"></i>
                    ویرایش معلومات خرید
                </a>
                {% elif form.instance.pk %}
                <a href="{% url 'purchaseinfo-create' %}?car={{ form.instance.id }}" 
                   class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                    <i class="fas fa-plus ml-1"></i>
                    افزودن معلومات خرید
                </a>
                {% endif %}
            </div>
        </div>
        
        <div class="px-6 py-6">
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700">VIN#</label>
                        {{ form.vin }}
                        {% if form.vin.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.vin.errors }}</p>
                        {% endif %}
                    </div>

                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700">MARK</label>
                        {{ form.mark }}
                        {% if form.mark.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.mark.errors }}</p>
                        {% endif %}
                    </div>

                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700">نوع</label>
                        {{ form.car_type }}
                        {% if form.car_type.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.car_type.errors }}</p>
                        {% endif %}
                    </div>

                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700">مدل سال</label>
                        {{ form.model_year }}
                        {% if form.model_year.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.model_year.errors }}</p>
                        {% endif %}
                    </div>

                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700">آیشن</label>
                        {{ form.action }}
                        {% if form.action.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.action.errors }}</p>
                        {% endif %}
                    </div>

                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700">رنگ</label>
                        {{ form.color }}
                        {% if form.color.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.color.errors }}</p>
                        {% endif %}
                    </div>

                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700">موقعیت</label>
                        {{ form.position }}
                        {% if form.position.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.position.errors }}</p>
                        {% endif %}
                    </div>

                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700">مربوطیت</label>
                        {{ form.related }}
                        {% if form.related.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.related.errors }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 space-x-reverse pt-4 border-t border-gray-200">
                    <a href="{% url 'carinfo-list' %}" class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors duration-200">
                        <i class="fas fa-times ml-1"></i>
                        انصراف
                    </a>
                    <button type="submit" class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200">
                        <i class="fas fa-save ml-1"></i>
                        {% if form.instance.pk %}ذخیره تغییرات{% else %}ایجاد{% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% if form.instance.pk %}
    <!-- Tab Navigation -->
    <div class="mb-6 border-b border-gray-200">
        <nav class="-mb-px flex space-x-8 space-x-reverse" aria-label="Tabs">
            <button onclick="showTab('purchase-tab')" 
                    class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-primary-500 text-primary-600">
                <i class="fas fa-shopping-cart ml-1"></i>
                معلومات خرید
            </button>
            <button onclick="showTab('shipping-tab')" 
                    class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                <i class="fas fa-shipping-fast ml-1"></i>
                اطلاعات حمل و نقل
            </button>
            <button onclick="showTab('world-tab')" 
                    class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                <i class="fas fa-globe-asia ml-1"></i>
                مصارف انتقالات
            </button>
            <button onclick="showTab('kabul-tab')" 
                    class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                <i class="fas fa-city ml-1"></i>
                مصارف کابل
            </button>
            <button onclick="showTab('repair-tab')" 
                    class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                <i class="fas fa-tools ml-1"></i>
                هزینه های تعمیر
            </button>
            <button onclick="showTab('sale-tab')" 
                    class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                <i class="fas fa-hand-holding-usd ml-1"></i>
                اطلاعات فروش
            </button>
            <button onclick="showTab('images-tab')" 
                    class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                <i class="fas fa-images ml-1"></i>
                عکس‌های موتر
            </button>
        </nav>
    </div>

    <!-- Tab Contents -->
    <div id="purchase-tab" class="tab-content">
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-green-50 to-green-100">
                <div class="flex justify-between items-center">
                    <h4 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-shopping-cart mr-2 text-green-600"></i>
                        معلومات خرید
                    </h4>
                    {% if form.instance.purchase_info %}
                    <a href="{% url 'purchaseinfo-update' form.instance.purchase_info.id %}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 transition-colors duration-200">
                        <i class="fas fa-edit ml-1"></i>
                        ویرایش
                    </a>
                    {% else %}
                    <a href="{% url 'purchaseinfo-create' %}?car={{ form.instance.id }}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-plus ml-1"></i>
                        افزودن
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="px-6 py-4">
                {% if form.instance.purchase_info %}
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">قیمت خرید:</p>
                        <p class="font-bold text-lg">{{ form.instance.purchase_info.purchase_price|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">مبلغ پرداخت شده:</p>
                        <p class="font-bold text-lg text-green-600">{{ form.instance.purchase_info.paid_amount|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">باقیمانده:</p>
                        <p class="font-bold text-lg text-red-600">{{ form.instance.purchase_info.formatted_remain_purchase }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تاریخ خرید:</p>
                        <p class="font-bold">{{ form.instance.purchase_info.buy_date|date:"Y/m/d H:i" }}</p>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-6">
                    <i class="fas fa-info-circle text-gray-400 text-4xl mb-3"></i>
                    <p class="text-gray-500">معلومات خرید ثبت نشده است.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="shipping-tab" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-blue-100">
                <div class="flex justify-between items-center">
                    <h4 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-shipping-fast mr-2 text-blue-600"></i>
                        اطلاعات حمل و نقل
                    </h4>
                    {% if form.instance.shipping_info %}
                    <a href="{% url 'shippinginfo-update' form.instance.shipping_info.id %}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 transition-colors duration-200">
                        <i class="fas fa-edit ml-1"></i>
                        ویرایش
                    </a>
                    {% else %}
                    <a href="{% url 'shippinginfo-create' %}?car={{ form.instance.id }}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-plus ml-1"></i>
                        افزودن
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="px-6 py-4">
                {% if form.instance.shipping_info %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تاریخ رسید به امارات:</p>
                        <p class="font-bold">{{ form.instance.shipping_info.date_arrived_in_dubai|date:"Y/m/d"|default:"-" }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">ETD from USA:</p>
                        <p class="font-bold">{{ form.instance.shipping_info.etd_from_usa|date:"Y/m/d"|default:"-" }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">قیمت تمام شده الی دبی:</p>
                        <p class="font-bold">{{ form.instance.shipping_info.total_price_to_dubai|floatformat:2|default:"-" }} $</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">کمیشن نقدی پرداخت شده:</p>
                        <p class="font-bold">{{ form.instance.shipping_info.cash_paid_comission|floatformat:2|default:"-" }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">مبلغ پرداخت شده انوایس دبی:</p>
                        <p class="font-bold text-green-600">{{ form.instance.shipping_info.dubai_paid_invoice|floatformat:2|default:"-" }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">باقی انوایس دبی:</p>
                        <p class="font-bold text-red-600">{{ form.instance.shipping_info.dubai_remain_invoice|floatformat:2|default:"-" }} $</p>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-6">
                    <i class="fas fa-info-circle text-gray-400 text-4xl mb-3"></i>
                    <p class="text-gray-500">اطلاعات حمل و نقل ثبت نشده است.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="world-tab" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-purple-100">
                <div class="flex justify-between items-center">
                    <h4 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-globe-asia mr-2 text-purple-600"></i>
                        مصارف انتقالات
                    </h4>
                    {% if form.instance.world_expenses %}
                    <a href="{% url 'world_expenses_update' form.instance.world_expenses.id %}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 transition-colors duration-200">
                        <i class="fas fa-edit ml-1"></i>
                        ویرایش
                    </a>
                    {% else %}
                    <a href="{% url 'world_expenses_create' %}?car={{ form.instance.id }}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-plus ml-1"></i>
                        افزودن
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="px-6 py-4">
                {% if form.instance.world_expenses %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تاریخ رسید به هرات:</p>
                        <p class="font-bold">{{ form.instance.world_expenses.herat_arrival_date|date:"Y/m/d"|default:"-" }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تاریخ بارگیری از دبی:</p>
                        <p class="font-bold">{{ form.instance.world_expenses.return_date_from_dubai|date:"Y/m/d"|default:"-" }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تمام مصارف تا هرات:</p>
                        <p class="font-bold">{{ form.instance.world_expenses.all_expeses_to_herat|floatformat:2 }} $</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">قیمت شیپنگ به اسلام قلعه:</p>
                        <p class="font-bold">{{ form.instance.world_expenses.shipiping_price_to_islam_qala|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">محصول گمرکی:</p>
                        <p class="font-bold">{{ form.instance.world_expenses.gomrok_payment|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">کمیشن شرکت تجارتی:</p>
                        <p class="font-bold">{{ form.instance.world_expenses.business_company_comission|floatformat:2 }} $</p>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-6">
                    <i class="fas fa-info-circle text-gray-400 text-4xl mb-3"></i>
                    <p class="text-gray-500">مصارف انتقالات ثبت نشده است.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="kabul-tab" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-yellow-50 to-yellow-100">
                <div class="flex justify-between items-center">
                    <h4 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-city mr-2 text-yellow-600"></i>
                        مصارف کابل
                    </h4>
                    {% if form.instance.kabul_expenses %}
                    <a href="{% url 'kabul_expenses_update' form.instance.kabul_expenses.id %}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 transition-colors duration-200">
                        <i class="fas fa-edit ml-1"></i>
                        ویرایش
                    </a>
                    {% else %}
                    <a href="{% url 'kabul_expenses_create' %}?car={{ form.instance.id }}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-plus ml-1"></i>
                        افزودن
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="px-6 py-4">
                {% if form.instance.kabul_expenses %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تاریخ رسید به کابل:</p>
                        <p class="font-bold">{{ form.instance.kabul_expenses.arrival_date_kabul|date:"Y/m/d"|default:"هنوز نرسیده" }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">کرایه از هرات الی کابل:</p>
                        <p class="font-bold">{{ form.instance.kabul_expenses.herat_to_kabul_cost|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">قیمت تمام شد در کابل:</p>
                        <p class="font-bold">{{ form.instance.kabul_expenses.total_cost_in_kabul|floatformat:2 }} $</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">میزان مصارف از امریکا الى کابل:</p>
                        <p class="font-bold">{{ form.instance.kabul_expenses.usa_to_kabul_cost|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">باقی کرایه از هرات الی کابل:</p>
                        <p class="font-bold">{{ form.instance.kabul_expenses.remaining_price_from_herat_to_kabul|floatformat:2 }} $</p>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-6">
                    <i class="fas fa-info-circle text-gray-400 text-4xl mb-3"></i>
                    <p class="text-gray-500">مصارف کابل ثبت نشده است.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="repair-tab" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-orange-50 to-orange-100">
                <div class="flex justify-between items-center">
                    <h4 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-tools mr-2 text-orange-600"></i>
                        هزینه های تعمیر
                    </h4>
                    {% if form.instance.repair_expenses %}
                    <a href="{% url 'repair_expenses_update' form.instance.repair_expenses.id %}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 transition-colors duration-200">
                        <i class="fas fa-edit ml-1"></i>
                        ویرایش
                    </a>
                    {% else %}
                    <a href="{% url 'repair_expenses_create' %}?car={{ form.instance.id }}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-plus ml-1"></i>
                        افزودن
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="px-6 py-4">
                {% if form.instance.repair_expenses %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">هزینه تعمیرات:</p>
                        <p class="font-bold">{{ form.instance.repair_expenses.repair_cost|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">هزینه های دیگر:</p>
                        <p class="font-bold">{{ form.instance.repair_expenses.other_costs|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تمام شد نهایی:</p>
                        <p class="font-bold text-green-600">{{ form.instance.repair_expenses.final_cost|floatformat:2 }} $</p>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">توضیحات:</p>
                    <p class="font-bold">{{ form.instance.repair_expenses.description|default:"بدون توضیحات" }}</p>
                </div>
                {% else %}
                <div class="text-center py-6">
                    <i class="fas fa-info-circle text-gray-400 text-4xl mb-3"></i>
                    <p class="text-gray-500">هزینه های تعمیر ثبت نشده است.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="sale-tab" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-red-50 to-red-100">
                <div class="flex justify-between items-center">
                    <h4 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-hand-holding-usd mr-2 text-red-600"></i>
                        اطلاعات فروش
                    </h4>
                    {% if form.instance.sale_info %}
                    <a href="{% url 'sale_info_update' form.instance.sale_info.id %}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 transition-colors duration-200">
                        <i class="fas fa-edit ml-1"></i>
                        ویرایش
                    </a>
                    {% else %}
                    <a href="{% url 'sale_info_create' %}?car={{ form.instance.id }}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-plus ml-1"></i>
                        افزودن
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="px-6 py-4">
                {% if form.instance.sale_info %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">وضعیت:</p>
                        <p class="font-bold">
                            <span class="px-2 py-1 rounded-full text-xs 
                                {% if form.instance.sale_info.status == 'sold' %}bg-green-100 text-green-800
                                {% elif form.instance.sale_info.status == 'reserved' %}bg-blue-100 text-blue-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ form.instance.sale_info.get_status_display }}
                            </span>
                        </p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تاریخ فروش:</p>
                        <p class="font-bold">{{ form.instance.sale_info.sale_date|date:"Y/m/d"|default:"-" }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">قیمت فروش:</p>
                        <p class="font-bold">{{ form.instance.sale_info.sale_price|floatformat:2 }} $</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">باقی خریدار:</p>
                        <p class="font-bold text-red-600">{{ form.instance.sale_info.remaining_price_of_buyer|floatformat:2 }} $</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">تاریخ پرداخت باقی خریدار:</p>
                        <p class="font-bold">{{ form.instance.sale_info.buyer_remain_payment_date|date:"Y/m/d"|default:"-" }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500 mb-1">مفاد:</p>
                        <p class="font-bold text-green-600">{{ form.instance.sale_info.benefit|floatformat:2 }} $</p>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-6">
                    <i class="fas fa-info-circle text-gray-400 text-4xl mb-3"></i>
                    <p class="text-gray-500">اطلاعات فروش ثبت نشده است.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="images-tab" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-indigo-100">
                <div class="flex justify-between items-center">
                    <h4 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-images mr-2 text-indigo-600"></i>
                        عکس‌های موتر
                    </h4>
                    <a href="{% url 'car_images_create' %}?car={{ form.instance.id }}" 
                       class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-plus ml-1"></i>
                        افزودن عکس
                    </a>
                </div>
            </div>
            <div class="px-6 py-4">
                {% if form.instance.images.all %}
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {% for image in form.instance.images.all %}
                    <div class="relative group overflow-hidden rounded-xl">
                        <img src="{{ image.image.url }}" alt="{{ image.description|default:'عکس موتر' }}" 
                             class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300">
                            <a href="{{ image.image.url }}" target="_blank" 
                               class="text-white mx-2 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300" title="مشاهده">
                                <i class="fas fa-eye text-lg"></i>
                            </a>
                            <a href="{% url 'car_images_update' image.id %}" 
                               class="text-white mx-2 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300" title="ویرایش">
                                <i class="fas fa-edit text-lg"></i>
                            </a>
                            <a href="{% url 'car_images_delete' image.id %}" 
                               class="text-white mx-2 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300" title="حذف">
                                <i class="fas fa-trash text-lg"></i>
                            </a>
                        </div>
                        <p class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent px-3 py-2 text-white text-sm truncate">
                            {{ image.description|default:"بدون توضیح" }}
                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8">
                    <i class="fas fa-camera text-gray-400 text-4xl mb-3"></i>
                    <p class="text-gray-500">هیچ عکسی ثبت نشده است.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show the first tab by default
    showTab('purchase-tab');
});

function showTab(tabId) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Show the selected tab content
    document.getElementById(tabId).classList.remove('hidden');
    
    // Update tab button styles
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('border-primary-500', 'text-primary-600');
        button.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
    });
    
    // Highlight the active tab button
    const activeButton = document.querySelector(`button[onclick="showTab('${tabId}')"]`);
    if (activeButton) {
        activeButton.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
        activeButton.classList.add('border-primary-500', 'text-primary-600');
    }
}
</script>
{% endblock %}